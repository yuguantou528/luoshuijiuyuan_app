<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>统计分析 - 北斗落水救援</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f2f2f7;
            color: #000;
            user-select: none;
        }
        .ios-status-bar {
            height: 48px;
            background-color: #007AFF;
            color: white;
        }
        .bottom-tab {
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }
        .stats-card {
            background-color: #fff;
            border-radius: 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .section-title {
            font-weight: 600;
            font-size: 16px;
            color: #1f2937;
            position: relative;
            padding-left: 12px;
        }
        .section-title::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 16px;
            background: #007AFF;
            border-radius: 2px;
        }
        .stat-item {
            text-align: center;
            padding: 10px;
        }
        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 4px;
        }
        .stat-label {
            font-size: 12px;
            color: #6b7280;
        }
        .tab-button {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 2px solid transparent;
        }
        .tab-button.active {
            color: #007AFF;
            border-bottom: 2px solid #007AFF;
        }
        .alert-type-legend {
            display: flex;
            align-items: center;
            margin-right: 12px;
            font-size: 12px;
        }
        .legend-color {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 4px;
        }
        .table-container {
            overflow-x: auto;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        .data-table th {
            background-color: #f9fafb;
            text-align: left;
            padding: 10px;
            font-weight: 500;
            color: #4b5563;
            border-bottom: 1px solid #e5e7eb;
        }
        .data-table td {
            padding: 10px;
            border-bottom: 1px solid #e5e7eb;
            color: #1f2937;
        }
        .data-table tr:hover {
            background-color: #f9fafb;
        }
    </style>
</head>
<body class="h-screen flex flex-col">
    <!-- iOS 状态栏 -->
    <div class="ios-status-bar flex items-center justify-between px-6">
        <div class="text-sm font-semibold">09:07</div>
        <div class="notch flex space-x-1.5">
            <i class="fas fa-signal"></i>
            <i class="fas fa-wifi"></i>
            <i class="fas fa-battery-full"></i>
        </div>
    </div>

    <!-- 顶部导航栏 -->
    <div class="bg-white border-b border-gray-200 sticky top-0 z-10">
        <div class="flex items-center p-4">
            <a href="index.html" class="text-blue-500 mr-4">
                <i class="fas fa-chevron-left"></i>
            </a>
            <h1 class="text-xl font-semibold flex-1 text-center">统计分析</h1>
            <div class="w-6"></div> <!-- 用于平衡左侧返回按钮 -->
        </div>

        <!-- 分段控制器 (标签页) -->
        <div class="flex border-b border-gray-200">
            <button class="tab-button active" id="tab-overview" onclick="switchTab('overview')">
                总览
            </button>
            <button class="tab-button" id="tab-trend" onclick="switchTab('trend')">
                趋势分析
            </button>
            <button class="tab-button" id="tab-detail" onclick="switchTab('detail')">
                详细数据
            </button>
        </div>
    </div>

    <!-- 主内容区 -->
    <div class="flex-1 overflow-y-auto pb-20">
        <!-- 总览标签页 -->
        <div id="content-overview" class="p-4">
            <!-- 核心统计卡片 -->
            <div class="stats-card mb-4">
                <div class="p-4 pb-2">
                    <h3 class="section-title">核心统计</h3>
                </div>
                <div class="p-4 grid grid-cols-3 gap-2">
                    <div class="stat-item">
                        <div class="stat-number text-red-600">5</div>
                        <div class="stat-label">本月告警</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number text-green-600">42</div>
                        <div class="stat-label">累计救援</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number text-blue-600">95%</div>
                        <div class="stat-label">救援成功率</div>
                    </div>
                </div>
            </div>

            <!-- 救援时间统计 -->
            <div class="stats-card mb-4">
                <div class="p-4 pb-2">
                    <h3 class="section-title">救援时间统计</h3>
                </div>
                <div class="p-4">
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="stat-item">
                            <div class="stat-number text-amber-600">17分</div>
                            <div class="stat-label">平均救援时间</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number text-amber-600">4分</div>
                            <div class="stat-label">平均响应时间</div>
                        </div>
                    </div>
                    <div class="h-64">
                        <canvas id="rescueTimeChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- 设备状态统计 -->
            <div class="stats-card mb-4">
                <div class="p-4 pb-2">
                    <h3 class="section-title">设备状态统计</h3>
                </div>
                <div class="p-4">
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="stat-item">
                            <div class="stat-number text-purple-600">25台</div>
                            <div class="stat-label">活跃设备</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number text-purple-600">5台</div>
                            <div class="stat-label">需要维护</div>
                        </div>
                    </div>
                    <div class="h-64">
                        <canvas id="deviceStatusChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 趋势分析标签页 -->
        <div id="content-trend" class="p-4 hidden">
            <!-- 按月告警趋势 -->
            <div class="stats-card mb-4">
                <div class="p-4 pb-2">
                    <h3 class="section-title">告警趋势分析</h3>
                </div>
                <div class="p-4">
                    <div class="flex justify-end mb-2">
                        <div class="flex items-center">
                            <div class="alert-type-legend">
                                <div class="legend-color bg-red-500"></div>
                                <span>未救援</span>
                            </div>
                            <div class="alert-type-legend">
                                <div class="legend-color bg-green-500"></div>
                                <span>已救援</span>
                            </div>
                        </div>
                    </div>
                    <div class="h-64">
                        <canvas id="alertTrendChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- 救援效率趋势 -->
            <div class="stats-card mb-4">
                <div class="p-4 pb-2">
                    <h3 class="section-title">救援效率趋势</h3>
                </div>
                <div class="p-4">
                    <div class="h-64">
                        <canvas id="rescueEfficiencyChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- 地理分布趋势 -->
            <div class="stats-card mb-4">
                <div class="p-4 pb-2">
                    <h3 class="section-title">区域告警分布</h3>
                </div>
                <div class="p-4">
                    <div class="h-64">
                        <canvas id="regionDistributionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 详细数据标签页 -->
        <div id="content-detail" class="p-4 hidden">
            <!-- 告警详细数据 -->
            <div class="stats-card mb-4">
                <div class="p-4 pb-2">
                    <h3 class="section-title">告警详细数据</h3>
                </div>
                <div class="p-4">
                    <div class="flex justify-between items-center mb-4">
                        <div class="text-sm text-gray-500">
                            最近30天告警记录
                        </div>
                        <button class="px-3 py-1 bg-blue-50 text-blue-600 rounded-md text-sm">
                            <i class="fas fa-download mr-1"></i> 导出
                        </button>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>告警ID</th>
                                    <th>设备编号</th>
                                    <th>告警时间</th>
                                    <th>救援时长</th>
                                    <th>状态</th>
                                </tr>
                            </thead>
                            <tbody id="alert-data-table">
                                <!-- 表格数据将通过JavaScript填充 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 设备统计数据 -->
            <div class="stats-card mb-4">
                <div class="p-4 pb-2">
                    <h3 class="section-title">设备使用统计</h3>
                </div>
                <div class="p-4">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>设备ID</th>
                                    <th>告警次数</th>
                                    <th>救援次数</th>
                                    <th>平均电量</th>
                                    <th>状态</th>
                                </tr>
                            </thead>
                            <tbody id="device-data-table">
                                <!-- 表格数据将通过JavaScript填充 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 底部导航栏 -->
    <div class="bottom-tab py-2 px-6 grid grid-cols-4 gap-1 fixed bottom-0 left-0 right-0">
        <a href="index.html" class="flex flex-col items-center text-gray-400">
            <i class="fas fa-home text-lg"></i>
            <span class="text-xs mt-1">首页</span>
        </a>
        <a href="map.html" class="flex flex-col items-center text-gray-400">
            <i class="fas fa-map-marked-alt text-lg"></i>
            <span class="text-xs mt-1">地图</span>
        </a>
        <a href="alerts.html" class="flex flex-col items-center text-gray-400">
            <i class="fas fa-exclamation-circle text-lg"></i>
            <span class="text-xs mt-1">告警</span>
        </a>
        <a href="profile.html" class="flex flex-col items-center text-gray-400">
            <i class="fas fa-user text-lg"></i>
            <span class="text-xs mt-1">我的</span>
        </a>
    </div>

    <script>
        // 标签页切换逻辑
        function switchTab(tabName) {
            // 移除所有标签页的激活状态
            document.getElementById('tab-overview').classList.remove('active');
            document.getElementById('tab-trend').classList.remove('active');
            document.getElementById('tab-detail').classList.remove('active');
            
            // 隐藏所有内容
            document.getElementById('content-overview').classList.add('hidden');
            document.getElementById('content-trend').classList.add('hidden');
            document.getElementById('content-detail').classList.add('hidden');
            
            // 激活选中的标签页
            document.getElementById('tab-' + tabName).classList.add('active');
            document.getElementById('content-' + tabName).classList.remove('hidden');
        }

        // 模拟告警数据
        const alertHistoryData = [
            { id: 'A2207', deviceId: 'BD12345678', time: '2023-07-12 14:23', duration: '00:03:42', status: 'unrescued' },
            { id: 'A2206', deviceId: 'BD23456789', time: '2023-07-12 14:14', duration: '00:12:18', status: 'unrescued' },
            { id: 'A2205', deviceId: 'BD34567890', time: '2023-07-11 17:06', duration: '00:23:42', status: 'rescued' },
            { id: 'A2204', deviceId: 'BD45678901', time: '2023-07-10 09:33', duration: '00:18:05', status: 'rescued' },
            { id: 'A2203', deviceId: 'BD56789012', time: '2023-07-05 14:38', duration: '00:15:33', status: 'rescued' },
            { id: 'A2202', deviceId: 'BD12345678', time: '2023-06-28 10:12', duration: '00:21:17', status: 'rescued' },
            { id: 'A2201', deviceId: 'BD23456789', time: '2023-06-22 08:45', duration: '00:19:53', status: 'rescued' },
            { id: 'A2200', deviceId: 'BD34567890', time: '2023-06-15 16:30', duration: '00:14:28', status: 'rescued' },
            { id: 'A2199', deviceId: 'BD45678901', time: '2023-06-10 13:22', duration: '00:22:41', status: 'rescued' },
            { id: 'A2198', deviceId: 'BD56789012', time: '2023-06-05 11:14', duration: '00:16:37', status: 'rescued' }
        ];

        // 模拟设备数据
        const deviceStatsData = [
            { id: 'BD12345678', alertCount: 15, rescueCount: 14, avgBattery: '87%', status: '正常' },
            { id: 'BD23456789', alertCount: 12, rescueCount: 11, avgBattery: '76%', status: '正常' },
            { id: 'BD34567890', alertCount: 8, rescueCount: 8, avgBattery: '65%', status: '需充电' },
            { id: 'BD45678901', alertCount: 10, rescueCount: 9, avgBattery: '72%', status: '正常' },
            { id: 'BD56789012', alertCount: 6, rescueCount: 6, avgBattery: '80%', status: '正常' }
        ];

        // 填充表格数据
        function populateTableData() {
            const alertTableBody = document.getElementById('alert-data-table');
            const deviceTableBody = document.getElementById('device-data-table');
            
            // 清空表格
            alertTableBody.innerHTML = '';
            deviceTableBody.innerHTML = '';
            
            // 填充告警数据
            alertHistoryData.forEach(alert => {
                const row = document.createElement('tr');
                
                const statusClass = alert.status === 'rescued' ? 'text-green-600' : 'text-red-600';
                const statusText = alert.status === 'rescued' ? '已救援' : '未救援';
                
                row.innerHTML = `
                    <td>${alert.id}</td>
                    <td>${alert.deviceId}</td>
                    <td>${alert.time}</td>
                    <td>${alert.duration}</td>
                    <td class="${statusClass}">${statusText}</td>
                `;
                
                alertTableBody.appendChild(row);
            });
            
            // 填充设备数据
            deviceStatsData.forEach(device => {
                const row = document.createElement('tr');
                
                const statusClass = device.status === '正常' ? 'text-green-600' : 'text-amber-600';
                
                row.innerHTML = `
                    <td>${device.id}</td>
                    <td>${device.alertCount}</td>
                    <td>${device.rescueCount}</td>
                    <td>${device.avgBattery}</td>
                    <td class="${statusClass}">${device.status}</td>
                `;
                
                deviceTableBody.appendChild(row);
            });
        }

        // 初始化图表
        function initCharts() {
            // 救援时间分布图
            const rescueTimeCtx = document.getElementById('rescueTimeChart').getContext('2d');
            new Chart(rescueTimeCtx, {
                type: 'bar',
                data: {
                    labels: ['<10分钟', '10-15分钟', '15-20分钟', '20-25分钟', '>25分钟'],
                    datasets: [{
                        label: '救援次数',
                        data: [8, 14, 12, 6, 2],
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: 'rgb(59, 130, 246)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });

            // 设备状态分布图
            const deviceStatusCtx = document.getElementById('deviceStatusChart').getContext('2d');
            new Chart(deviceStatusCtx, {
                type: 'doughnut',
                data: {
                    labels: ['正常', '需充电', '需检修', '离线'],
                    datasets: [{
                        data: [20, 3, 1, 1],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.6)',
                            'rgba(245, 158, 11, 0.6)',
                            'rgba(239, 68, 68, 0.6)',
                            'rgba(107, 114, 128, 0.6)'
                        ],
                        borderColor: [
                            'rgb(16, 185, 129)',
                            'rgb(245, 158, 11)',
                            'rgb(239, 68, 68)',
                            'rgb(107, 114, 128)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // 告警趋势图
            const alertTrendCtx = document.getElementById('alertTrendChart').getContext('2d');
            new Chart(alertTrendCtx, {
                type: 'line',
                data: {
                    labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月'],
                    datasets: [
                        {
                            label: '未救援告警',
                            data: [0, 0, 1, 0, 1, 3, 2],
                            backgroundColor: 'rgba(239, 68, 68, 0.2)',
                            borderColor: 'rgb(239, 68, 68)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: '已救援告警',
                            data: [3, 5, 7, 6, 8, 10, 3],
                            backgroundColor: 'rgba(16, 185, 129, 0.2)',
                            borderColor: 'rgb(16, 185, 129)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });

            // 救援效率趋势图
            const rescueEfficiencyCtx = document.getElementById('rescueEfficiencyChart').getContext('2d');
            new Chart(rescueEfficiencyCtx, {
                type: 'line',
                data: {
                    labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月'],
                    datasets: [{
                        label: '平均救援时间(分钟)',
                        data: [21, 19, 18, 17, 15, 16, 17],
                        backgroundColor: 'rgba(251, 191, 36, 0.2)',
                        borderColor: 'rgb(251, 191, 36)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        yAxisID: 'y'
                    }, {
                        label: '救援成功率(%)',
                        data: [88, 90, 91, 93, 94, 95, 95],
                        backgroundColor: 'rgba(79, 70, 229, 0.2)',
                        borderColor: 'rgb(79, 70, 229)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            position: 'left',
                            title: {
                                display: true,
                                text: '分钟'
                            }
                        },
                        y1: {
                            beginAtZero: false,
                            position: 'right',
                            min: 80,
                            max: 100,
                            title: {
                                display: true,
                                text: '%'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });

            // 区域分布图
            const regionDistributionCtx = document.getElementById('regionDistributionChart').getContext('2d');
            new Chart(regionDistributionCtx, {
                type: 'bar',
                data: {
                    labels: ['福建南部海区', '福建东部海区', '浙江南部海区', '台湾海峡', '其他区域'],
                    datasets: [{
                        label: '告警次数',
                        data: [18, 12, 8, 4, 0],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.6)',
                            'rgba(99, 102, 241, 0.6)',
                            'rgba(139, 92, 246, 0.6)',
                            'rgba(168, 85, 247, 0.6)',
                            'rgba(217, 70, 239, 0.6)'
                        ],
                        borderColor: [
                            'rgb(59, 130, 246)',
                            'rgb(99, 102, 241)',
                            'rgb(139, 92, 246)',
                            'rgb(168, 85, 247)',
                            'rgb(217, 70, 239)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
        }

        // 页面加载完成后初始化数据和图表
        window.onload = function() {
            populateTableData();
            initCharts();
        };
    </script>
</body>
</html> 